<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cart</title>

  <!-- Brand font -->
  <link href="https://fonts.googleapis.com/css2?family=Poetsen+One&display=swap" rel="stylesheet">

  <style>
    /* ===== THEME TOKENS ===== */
    :root{
      --icon-color-default:#ddeaef;
      --icon-color-active:#789cac;

      --shell:#85adb8;
      --fg:#FBFAF5;
      --page-bg: var(--shell);
      --accent:#ef4444;

      --chip-bg:#072a54;
      --chip-fg:#fff;

      /* Glass surface */
      --glass-bg: rgba(255,255,255,0.35);
      --glass-border: rgba(255,255,255,0.35);
      --glass-blur: blur(14px) saturate(1.12);
    }

    /* ===== HERO HEADER (same as store) ===== */
    .hero{
      position:relative;
      height:clamp(160px, 28vw, 260px);
      max-width: 1200px;
      margin: 0 auto;
      border-radius:14px;
      overflow:visible;
      background-image:url("assets/images/Breezy%20Banner.png");
      background-size:cover;
      background-position:center 30%;
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background:linear-gradient(to bottom, rgba(0,0,0,.25), rgba(0,0,0,.25));
      pointer-events:none;
      border-radius: inherit;
    }

    /* Centered brand block */
    .brand-center {
      position: absolute;
      inset: 0;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: var(--fg);
      padding: 0 12px;
      pointer-events: none;
    }
    @media (min-width: 768px){
      .brand-center > div { transform: translateY(0); }
    }
    .brand-title {
      margin: 0;
      line-height: 1.1;
      font-weight: 800;
      font-family: "Poetsen One", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-size: 45px;
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
    }
    @media (max-width: 767.98px){
      .brand-title { font-size: 17px; }
      .brand-center > div { transform: translateY(10px); }
    }
    .brand-subtitle{
      margin:.35rem 0 0 0;
      opacity:.95;
      font-size:clamp(0.8rem, 3vw, 1.2rem);
      text-shadow:0 1px 6px rgba(0,0,0,.35);
    }

    /* Layout/base */
    html,body{ height:100%; }
    body{
      font-family: Arial, sans-serif;
      background: var(--page-bg);
      margin: 0;
      color:#111827;
    }
    .site-shell{
      position: sticky; top:0; z-index:20;
      background: var(--shell);
      color: var(--fg);
      box-shadow: none;
    }
    .shell-pad{ padding:10px 12px 6px; }

    .container{
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 16px;
    }

    .page-wrap{ margin: 16px auto 24px; }

    /* Buttons */
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      height:42px; padding:0 14px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.12);
      background:#fff; color:#111;
      font-weight:600; cursor:pointer;
      transition: transform .12s ease, background .15s ease, opacity .15s ease;
      text-decoration:none;
    }
    .btn:hover{ transform: translateY(-3px); }
    .btn[disabled]{ opacity:.45; cursor:not-allowed; transform:none; }
    .btn--ghost{ background:transparent; color:#111; border-color: rgba(0,0,0,.22); }
    .btn--danger{ background: var(--accent); color:#fff; border-color: transparent; }

    /* Glass back button */
    .back-btn--glass{
      background: var(--glass-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border:1px solid var(--glass-border);
      color:#0f172a;
      box-shadow:0 10px 24px rgba(2,6,23,0.25);
    }
    @media (prefers-color-scheme: dark){
      .back-btn--glass{
        background: rgba(2, 6, 23, 0.55);
        border-color: rgba(255,255,255,0.12);
        color:#e5e7eb;
        box-shadow:0 14px 32px rgba(0,0,0,0.55);
      }
    }
    .back-in-hero{ position:absolute; top:12px; left:12px; z-index:3; pointer-events:auto; }
    @media (max-width:767.98px){
      .back-in-hero .btn{ height:20px; padding:0 12px; font-weight:500; }
    }
    .back-btn{ background:#2b6cb0; color:#FBFAF5; }

    /* === qty & remove controls (match mini-cart look) === */
.icon-btn{
  display:inline-flex; align-items:center; justify-content:center;
  width:28px; height:28px; border-radius:8px;
  border:1px solid rgba(0,0,0,.12);
  background:#fff; cursor:pointer;
  transition: transform .12s ease, background .15s ease, opacity .15s ease;
}
.icon-btn:hover{ transform: translateY(-2px); }
.icon-btn img{ width:18px; height:18px; display:block; pointer-events:none; }

.qty-controls{
  display:inline-flex; align-items:center; gap:6px;
  flex-wrap: nowrap;   /* üëà ensure on one line */
}

.qty-controls .pill{
  min-width:28px; text-align:center; padding:4px 8px;
  border:1px solid rgba(0,0,0,.1); border-radius:999px; background:#fff;
  font-weight:600;
}

    /* Cart layout: items | summary */
    .cart-layout{
      display:grid; gap:16px;
      grid-template-columns: 2fr 1fr;
    }
    @media (max-width: 767.98px){ .cart-layout{ grid-template-columns: 1fr; } }

    /* Cards / table */
    .card-panel{
      background:#fff;
      border-radius:12px;
      box-shadow:0 8px 20px rgba(0,0,0,.05);
      overflow:hidden;
    }
    .cart-table{ width: 100%; border-collapse: collapse; }
    .cart-table th, .cart-table td{
      border-bottom:1px solid #eee;
      padding: 12px;
      text-align: center;
      vertical-align: middle;
    }
    .cart-table th{ text-align:left; font-weight:700; }
    .cart-table td:first-child, .cart-table th:first-child{ text-align:left; }

    .thumb{
      width:64px; height:64px; border-radius:6px; background:#fff;
      display:flex; align-items:center; justify-content:center; overflow:hidden;
      box-shadow:0 2px 6px rgba(0,0,0,.05);
    }
    .thumb img{ width:100%; height:100%; object-fit:contain; display:block; }

    /* Smaller font for mobile cart cells (desktop table) */
    @media (max-width:767.98px){
      .cart-table td, .cart-table th { font-size: 0.65rem; padding: 8px; }
    }
    /* Prevent any numeric overflow in the desktop table */
    .cart-table td{
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* ===== Summary (glass) ===== */
    .summary.glass{
      padding:14px;
      background: var(--glass-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border:1px solid var(--glass-border);
      border-radius:12px;
      box-shadow:0 18px 40px rgba(2,6,23,0.25);
      color:#0f172a;
    }
    @media (prefers-color-scheme: dark){
      .summary.glass{
        background: rgba(2, 6, 23, 0.55);
        border-color: rgba(255,255,255,0.12);
        color:#e5e7eb;
        box-shadow:0 18px 42px rgba(0,0,0,0.55);
      }
    }
    .summary h3{ margin:0 0 10px; font-size:1.1rem; }
    .row{ display:flex; align-items:center; justify-content:space-between; margin:6px 0; }
    .summary-actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; margin-top:10px; }

    /* === Responsive switch between desktop head and mobile head (table) === */
    .head-mobile{ display:none; }
    @media (max-width:767.98px){
      .head-desktop{ display:none; }
      .head-mobile{ display:table-row; }
    }

    /* ========= Mini-cart style rows for MOBILE ========= */

    /* Default: show table panel, hide list panel */
    #cart-list-panel { display: none; }

    /* Mobile: hide table, show list */
    @media (max-width: 767.98px){
      .cart-table { display: none; }
      #cart-list-panel { display: block; }
    }

    .cart-list { padding: 8px; }

    /* One row = [thumb] [meta] [line-total] */
.cart-item {
  display: grid;
  grid-template-columns: 56px 1fr 80px;  /* üëà last column reserved for total */
  gap: 10px;
  align-items: center;
  padding: 10px 12px;
  border-bottom: 1px solid #eee;
}

    .ci-thumb{
      width:56px; height:56px; border-radius:6px;
      background:#fff; display:flex; align-items:center; justify-content:center;
      overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,.05);
    }
    .ci-thumb img{ max-width:100%; max-height:100%; object-fit:contain; display:block; }

    .ci-meta{ min-width:0; }
    .ci-name{
      margin:0 0 4px;
      font-weight:700; font-size:.95rem; line-height:1.2;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .ci-sub {
  margin: 0;
  font-size: .85rem;
  line-height: 1.25;
  opacity: .9;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 600;   /* üëà added bold */
}

    .ci-attrs {
  margin: 2px 0 6px;
  font-size: .70rem;
  line-height: 1.3;
  max-height: calc(1.3em * 3); /* clamp to 3 lines */
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;

  max-width: 120px;       /* üëà adjust as needed */
  white-space: normal;    /* allow wrapping */
  word-break: break-word; /* break long words if needed */
  opacity: .8;
  padding-bottom: 2px;
}

    .ci-qty{
      margin-top:6px; display:inline-flex; align-items:center; gap:6px;
      font-size:.9rem;
    }
    .ci-qty .pill{
      min-width:22px; text-align:center; padding:2px 8px;
      border:1px solid rgba(0,0,0,.1); border-radius:999px; background:#fff;
    }

   .ci-right{
  font-weight:700;
  font-size:.95rem;
  white-space:nowrap;
  text-align:right;        /* stays right-aligned */
  justify-self:end;        /* üëà align to far right of its grid column */
  overflow:hidden;
  text-overflow:ellipsis;
}

/* On small screens adjust only font sizes */
@media (max-width: 480px){
  .ci-name{ font-size:.9rem; }
  .ci-sub{ font-size:.8rem; }
  .ci-right{
    font-size:.9rem;
    /* keep text-align:right + justify-self:end here */
  }
}

  </style>
</head>
<body>

  <!-- ===== Shell / Hero ===== -->
  <div class="site-shell">
    <div class="shell-pad">
      <div class="hero">
        <div class="banner-bar"></div>

        <div class="back-in-hero">
          <a href="index.html" class="btn back-btn--glass" aria-label="Back to Store">‚Üê Store</a>
        </div>

        <div class="brand-center">
          <div>
            <h1 class="brand-title">YOUR HAND-PICKED MAGIC AWAITS‚ú®</h1>
            <p class="brand-subtitle"><strong>Happiness is only a checkout away (*ÀòÔ∏∂Àò*).ÔΩ°.:*‚ô°</strong></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Main ===== -->
  <div class="container page-wrap">

    <div class="cart-layout">
      <!-- LEFT: items -->
      <div class="card-panel">
        <table class="cart-table">
          <thead>
            <tr class="head-desktop">
              <th>Item</th><th>Qty</th><th>Unit Price</th><th>Total</th>
            </tr>
            <tr class="head-mobile">
              <th>Image</th><th>Product</th><th>Qty</th><th>Unit Price</th><th>Total</th>
            </tr>
          </thead>
          <tbody id="cart-items"></tbody>
        </table>
      </div>

      <!-- Mobile list version (mini-cart style) -->
      <div class="card-panel" id="cart-list-panel">
        <div id="cart-list" class="cart-list"></div>
      </div>

      <!-- RIGHT: summary -->
      <aside class="summary glass">
        <h3>Order Summary</h3>
        <div class="row">
          <span>Subtotal</span>
          <strong id="sumSubtotal">$0.00</strong>
        </div>
        <hr style="border:none; border-top:1px solid rgba(255,255,255,0.25); margin:10px 0;">
        <div class="row">
          <span>Total</span>
          <strong id="sumTotal">$0.00</strong>
        </div>
        <div class="summary-actions">
          <button onclick="clearCart()" class="btn btn--danger">Clear Cart</button>
          <button onclick="checkout()" class="btn">Checkout</button>
        </div>
      </aside>
    </div>

    <!-- Legacy readout -->
    <div class="row" style="justify-content:flex-end; margin-top:12px;">
      <div id="order-total" style="font-weight:700;">Order Total: $0.00</div>
    </div>
  </div>
  
  <script>
  /* ===== Helpers: stable key for each unique cart line ===== */
  function itemKey(it){
    return [
      it.name ?? '',
      String(Number(it.price) || 0),
      it.series ?? '',
      it.rarity ?? '',
      it.condition ?? ''
    ].join('||');
  }
  function escapeKey(it){
    return itemKey(it).replace(/\\/g,'\\\\').replace(/'/g,"\\'");
  }

  /* ===== Cart IO ===== */
  function getCart(){
    try{
      const raw = JSON.parse(localStorage.getItem("cart") || "[]");
      return Array.isArray(raw) ? raw : [];
    }catch{ return []; }
  }
  function saveCart(cart){
    localStorage.setItem("cart", JSON.stringify(cart));
  }

  /* ===== Mutators used by + / ‚àí / remove buttons ===== */
  function incQty(key){
    const cart = getCart();
    const i = cart.findIndex(it => itemKey(it) === key);
    if(i >= 0){
      cart[i].quantity = (Number(cart[i].quantity)||0) + 1;
      saveCart(cart); renderCart();
    }
  }
  function decQty(key){
    const cart = getCart();
    const i = cart.findIndex(it => itemKey(it) === key);
    if(i >= 0){
      const q = (Number(cart[i].quantity)||0) - 1;
      if(q <= 0){ cart.splice(i,1); } else { cart[i].quantity = q; }
      saveCart(cart); renderCart();
    }
  }
  function removeItem(key){
    const cart = getCart().filter(it => itemKey(it) !== key);
    saveCart(cart); renderCart();
  }

  // ===== CLEAN VERSION =====
  function renderCart() {
    const cart = getCart();
    const cartContainer = document.getElementById("cart-items");
    const cartList = document.getElementById("cart-list"); // mobile list
    const totalDisplay = document.getElementById("order-total");
    const sumSubtotal = document.getElementById("sumSubtotal");
    const sumTotal = document.getElementById("sumTotal");

    cartContainer.innerHTML = "";
    if (cartList) cartList.innerHTML = "";

    let total = 0;

    if (cart.length === 0) {
      cartContainer.innerHTML = `<tr><td colspan="4" style="text-align:center;">Your cart is empty.</td></tr>`;
      if (cartList) {
        cartList.innerHTML = `
          <div class="cart-item" style="justify-content:center; grid-template-columns:1fr;">
            <div style="opacity:.75;">Your cart is empty.</div>
          </div>`;
      }
      totalDisplay.innerText = "Order Total: $0.00";
      if (sumSubtotal) sumSubtotal.textContent = "$0.00";
      if (sumTotal) sumTotal.textContent = "$0.00";
      return;
    }

    cart.forEach(item => {
      const row = document.createElement("tr");
      const imagePath = item.image || item.image_url || "assets/images/default.png";
      const qty = Number(item.quantity) || 0;
      const unit = Number(item.price) || 0;
      const line = qty * unit;
      total += line;

      const isMobile = window.matchMedia("(max-width: 767.98px)").matches;

      // Desktop (4 columns) OR Mobile-table (5 columns)
      row.innerHTML = isMobile
        ? `
          <td><div class="thumb"><img src="${imagePath}" alt="${item.name || 'Item'}" /></div></td>
          <td>
            <div style="font-weight:700; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
              ${item.name || ''}
            </div>
            <div style="opacity:.8; font-size:.9rem;">
              ${(item.series ? `${item.series}` : '')}
              ${(item.rarity ? ` ¬∑ ${item.rarity}` : '')}
              ${(item.condition ? ` ¬∑ ${item.condition}` : '')}
            </div>
          </td>
          <td>${qty}</td>
          <td>$${unit.toFixed(2)}</td>
          <td><strong>$${line.toFixed(2)}</strong></td>
        `
        : `
          <td>
            <div style="display:flex; gap:10px; align-items:center; min-width:0;">
              <div class="thumb"><img src="${imagePath}" alt="${item.name || 'Item'}" /></div>
              <div style="min-width:0;">
                <div style="font-weight:700; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                  ${item.name || ''}
                </div>
                <div style="opacity:.8; font-size:.9rem;">
                  ${(item.series ? `${item.series}` : '')}
                  ${(item.rarity ? ` ¬∑ ${item.rarity}` : '')}
                  ${(item.condition ? ` ¬∑ ${item.condition}` : '')}
                </div>
              </div>
            </div>
          </td>
          <td>
            <div class="qty-controls">
              <button class="icon-btn" aria-label="Reduce" onclick="decQty('${escapeKey(item)}')">
                <img src="assets/images/minus%20button.svg" alt="-">
              </button>
              <span class="pill">${qty}</span>
              <button class="icon-btn" aria-label="Add" onclick="incQty('${escapeKey(item)}')">
                <img src="assets/images/plus%20button.svg" alt="+">
              </button>
              <button class="icon-btn" aria-label="Remove" onclick="removeItem('${escapeKey(item)}')">
                <img src="assets/images/bin.svg" alt="Remove">
              </button>
            </div>
          </td>
          <td>$${unit.toFixed(2)}</td>
          <td><strong>$${line.toFixed(2)}</strong></td>
        `;

      cartContainer.appendChild(row);

      // --- Mobile list item (mini-cart style) ---
      if (cartList) {
        const li = document.createElement("div");
        li.className = "cart-item";

        const attrs = [
          (item.series ? `${item.series}` : ''),
          (item.rarity ? ` ¬∑ ${item.rarity}` : ''),
          (item.condition ? ` ¬∑ ${item.condition}` : '')
        ].join('').replace(/^ ¬∑ /,'');

        li.innerHTML = `
          <div class="ci-thumb">
            <img src="${imagePath}" alt="${item.name || 'Item'}">
          </div>
          <div class="ci-meta">
            <p class="ci-name" title="${item.name || ''}">${item.name || ''}</p>
            ${attrs ? `<p class="ci-attrs">${attrs}</p>` : ''}

            <!-- Unit price (bold per your spec) -->
            <p class="ci-sub"><strong>$${unit.toFixed(2)}</strong></p>

            <!-- Quantity controls -->
<div class="ci-qty">
  <div class="qty-controls">
    <button class="icon-btn" aria-label="Reduce" onclick="decQty('${escapeKey(item)}')">
      <img src="assets/images/minus%20button.svg" alt="-">
    </button>
    <span class="pill">${qty}</span>
    <button class="icon-btn" aria-label="Add" onclick="incQty('${escapeKey(item)}')">
      <img src="assets/images/plus%20button.svg" alt="+">
    </button>
    <!-- NEW: bin button (same style as index mini-cart) -->
    <button class="icon-btn" aria-label="Remove item" onclick="removeItem('${escapeKey(item)}')">
      <img src="assets/images/bin.svg" alt="Remove">
    </button>
  </div>
</div>


          <!-- Line total -->
          <div class="ci-right">$${line.toFixed(2)}</div>
        `;
        cartList.appendChild(li);
      }
    }); // end forEach

    // Totals
    const money = v => `$${(Number(v)||0).toFixed(2)}`;
    totalDisplay.innerText = `Order Total: ${money(total)}`;
    if (sumSubtotal) sumSubtotal.textContent = money(total);
    if (sumTotal) sumTotal.textContent = money(total);
  }

  function clearCart() {
    localStorage.removeItem("cart");
    renderCart();
  }

  function checkout() {
    alert("Checkout functionality not implemented yet.");
  }

  // Initial load
  renderCart();
</script>
</body>
</html>
